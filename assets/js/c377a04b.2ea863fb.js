"use strict";(self.webpackChunk_honestfoodcompany_pubsub=self.webpackChunk_honestfoodcompany_pubsub||[]).push([[971],{3905:(e,t,r)=>{r.d(t,{Zo:()=>c,kt:()=>m});var n=r(7294);function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function o(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){a(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function s(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},i=Object.keys(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}var p=n.createContext({}),l=function(e){var t=n.useContext(p),r=t;return e&&(r="function"==typeof e?e(t):o(o({},t),e)),r},c=function(e){var t=l(e.components);return n.createElement(p.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},d=n.forwardRef((function(e,t){var r=e.components,a=e.mdxType,i=e.originalType,p=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),d=l(r),m=a,b=d["".concat(p,".").concat(m)]||d[m]||u[m]||i;return r?n.createElement(b,o(o({ref:t},c),{},{components:r})):n.createElement(b,o({ref:t},c))}));function m(e,t){var r=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=r.length,o=new Array(i);o[0]=d;var s={};for(var p in t)hasOwnProperty.call(t,p)&&(s[p]=t[p]);s.originalType=e,s.mdxType="string"==typeof e?e:a,o[1]=s;for(var l=2;l<i;l++)o[l]=r[l];return n.createElement.apply(null,o)}return n.createElement.apply(null,r)}d.displayName="MDXCreateElement"},3874:(e,t,r)=>{r.r(t),r.d(t,{frontMatter:()=>s,contentTitle:()=>p,metadata:()=>l,toc:()=>c,default:()=>d});var n=r(3117),a=r(102),i=(r(7294),r(3905)),o=["components"],s={id:"index",title:"PubSub Framework",sidebar_position:0,slug:"/"},p=void 0,l={unversionedId:"index",id:"index",isDocsHomePage:!1,title:"PubSub Framework",description:"@honestfoodcompany/pubsub",source:"@site/docs/index.md",sourceDirName:".",slug:"/",permalink:"/hfc-pubsub/",editUrl:"https://github.com/deliveryhero/hfc-pubsub/edit/main/docs/docs/index.md",version:"current",sidebarPosition:0,frontMatter:{id:"index",title:"PubSub Framework",sidebar_position:0,slug:"/"},sidebar:"defaultSidebar",next:{title:"CLI",permalink:"/hfc-pubsub/cli"}},c=[{value:"@honestfoodcompany/pubsub",id:"honestfoodcompanypubsub",children:[]},{value:"Features",id:"features",children:[]},{value:"Getting started",id:"getting-started",children:[]},{value:"Required Environment Variables",id:"required-environment-variables",children:[]}],u={toc:c};function d(e){var t=e.components,s=(0,a.Z)(e,o);return(0,i.kt)("wrapper",(0,n.Z)({},u,s,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h2",{id:"honestfoodcompanypubsub"},"@honestfoodcompany/pubsub"),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://www.npmjs.com/package/@honestfoodcompany/pubsub"},(0,i.kt)("img",{parentName:"a",src:"https://img.shields.io/npm/v/@honestfoodcompany/pubsub",alt:"npm"})),"\n",(0,i.kt)("a",{parentName:"p",href:"https://github.com/deliveryhero/hfc-pubsub/actions/workflows/build.yml"},(0,i.kt)("img",{parentName:"a",src:"https://github.com/deliveryhero/hfc-pubsub/actions/workflows/build.yml/badge.svg",alt:"Node.js CI"})),"\n",(0,i.kt)("a",{parentName:"p",href:"https://www.codacy.com?utm_source=github.com&utm_medium=referral&utm_content=deliveryhero/hfc-pubsub&utm_campaign=Badge_Grade"},(0,i.kt)("img",{parentName:"a",src:"https://app.codacy.com/project/badge/Grade/70fe253d1da34e8aa16bf37ae613d2fe",alt:"Codacy Badge"})),"\n",(0,i.kt)("a",{parentName:"p",href:"https://www.codacy.com?utm_source=github.com&utm_medium=referral&utm_content=deliveryhero/hfc-pubsub&utm_campaign=Badge_Coverage"},(0,i.kt)("img",{parentName:"a",src:"https://app.codacy.com/project/badge/Coverage/70fe253d1da34e8aa16bf37ae613d2fe",alt:"Codacy Badge"})),"\n",(0,i.kt)("a",{parentName:"p",href:"https://david-dm.org/deliveryhero/hfc-pubsub"},(0,i.kt)("img",{parentName:"a",src:"https://status.david-dm.org/gh/deliveryhero/hfc-pubsub.svg",alt:"dependencies Status"})),"\n",(0,i.kt)("a",{parentName:"p",href:"https://snyk.io/test/github/deliveryhero/hfc-pubsub/"},(0,i.kt)("img",{parentName:"a",src:"https://snyk.io/test/github/deliveryhero/hfc-pubsub/badge.svg",alt:"Known Vulnerabilities"}))),(0,i.kt)("p",null,"This package contains a lightweight framework and subscription server for ",(0,i.kt)("a",{parentName:"p",href:"https://cloud.google.com/pubsub"},"Google Pub/Sub"),". It was created to speed up development time and it provides a common foundation for building event driven applications. It lets developers define topics and subscriptions simply and declaratively, while additionally offering a simple subscription server to run all of a project's subscription handlers."),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"demo of subscription service starting through cli",src:r(84).Z})),(0,i.kt)("h2",{id:"features"},"Features"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Run all of your subscriptions at once with a subscription server"),(0,i.kt)("li",{parentName:"ol"},"Define pub/sub subscriptions and topics in a declarative way"),(0,i.kt)("li",{parentName:"ol"},"Define your subscription handlers with a simple object"),(0,i.kt)("li",{parentName:"ol"},"Get started quickly: define a topic and publish messages with a few lines of code")),(0,i.kt)("h2",{id:"getting-started"},"Getting started"),(0,i.kt)("p",null,"The framework expects that you've created a pubsub directory in your project with the following structure:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"\u251c\u2500\u2500 .env                <-- this should be in your project root directory\n\u251c\u2500\u2500 pubsub/             <-- this can be anywhere (defined in .env as PUBSUB_ROOT_DIR)\n\u2502\xa0\xa0 \u251c\u2500\u2500 subscriptions/\n\u2502\xa0\xa0 \u251c\u2500\u2500 topics/\n\u2502\xa0\xa0 \u2514\u2500\u2500 subscription.service.js <-- this is the entrypoint for the service\n\u2514\u2500\u2500 package.json\n")),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Once the directory structure has been defined, ",(0,i.kt)("a",{parentName:"li",href:"#required-environment-variables"},"environment variables should be set"),"."),(0,i.kt)("li",{parentName:"ol"},"Then you can create ",(0,i.kt)("a",{parentName:"li",href:"./Subscriptions"},"subscriptions")," and ",(0,i.kt)("a",{parentName:"li",href:"./Topics"},"topics")),(0,i.kt)("li",{parentName:"ol"},"After a subscription has been created, use the ",(0,i.kt)("a",{parentName:"li",href:"./CLI"},"CLI")," to start the subscriptions server."),(0,i.kt)("li",{parentName:"ol"},"Initialize your database connection, define project-level subscription defaults, and register subscriptions in the ",(0,i.kt)("a",{parentName:"li",href:"./service"},"Subscription Service"),".")),(0,i.kt)("h2",{id:"required-environment-variables"},"Required Environment Variables"),(0,i.kt)("p",null,"The framework expects the following environment variables. They can be added the ",(0,i.kt)("inlineCode",{parentName:"p"},".env")," file."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-ini",metastring:'title=".env"',title:'".env"'},"GOOGLE_APPLICATION_CREDENTIALS=/path/to/gcp-project-83d5537a8388-key.json\nGOOGLE_CLOUD_PUB_SUB_PROJECT_ID=gcp-project-id\nPUBSUB_ROOT_DIR=/path/to/your/pubsub/directory # this can be a relative path\n")),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"Variable"),(0,i.kt)("th",{parentName:"tr",align:null},"Description"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"PUBSUB_ROOT_DIR")),(0,i.kt)("td",{parentName:"tr",align:null},"must be the path to your project's pubsub directory. This module only works with .js files, so if you are writing your code in typescript, you must set this variable to the pubsub directory in your project's build directory.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"GOOGLE_APPLICATION_CREDENTIALS")),(0,i.kt)("td",{parentName:"tr",align:null},"see ",(0,i.kt)("a",{parentName:"td",href:"https://cloud.google.com/docs/authentication/getting-started#creating_a_service_account"},"https://cloud.google.com/docs/authentication/getting-started#creating_a_service_account")," to generate this")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"GOOGLE_CLOUD_PUB_SUB_PROJECT_ID")),(0,i.kt)("td",{parentName:"tr",align:null},"name of the project in Google Cloud Platform")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"PROJECT_NUMBER")," (Optional)"),(0,i.kt)("td",{parentName:"tr",align:null},"Project for binding DLQ roles. Check ",(0,i.kt)("a",{parentName:"td",href:"#binding-subscriber-and-publisher-role"},"Binding Subscriber and Publisher role")," for more details. If Not provided GOOGLE_CLOUD_PUB_SUB_PROJECT_ID is used to fetch the PROJECT_NUMBER")))))}d.isMDXComponent=!0},84:(e,t,r)=>{r.d(t,{Z:()=>n});const n=r.p+"assets/images/demo-3dbbe031937cea941fa9b9edc23b949a.gif"}}]);