<!doctype html>
<html class="default no-js">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>@honestfoodcompany/pubsub</title>
	<meta name="description" content="Documentation for @honestfoodcompany/pubsub">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="assets/css/main.css">
	<script async src="assets/js/search.js" id="search-script"></script>
</head>
<body>
<header>
	<div class="tsd-page-toolbar">
		<div class="container">
			<div class="table-wrap">
				<div class="table-cell" id="tsd-search" data-index="assets/js/search.json" data-base=".">
					<div class="field">
						<label for="tsd-search-field" class="tsd-widget search no-caption">Search</label>
						<input id="tsd-search-field" type="text" />
					</div>
					<ul class="results">
						<li class="state loading">Preparing search index...</li>
						<li class="state failure">The search index is not available</li>
					</ul>
					<a href="index.html" class="title">@honestfoodcompany/pubsub</a>
				</div>
				<div class="table-cell" id="tsd-widgets">
					<div id="tsd-filter">
						<a href="#" class="tsd-widget options no-caption" data-toggle="options">Options</a>
						<div class="tsd-filter-group">
							<div class="tsd-select" id="tsd-filter-visibility">
								<span class="tsd-select-label">All</span>
								<ul class="tsd-select-list">
									<li data-value="public">Public</li>
									<li data-value="protected">Public/Protected</li>
									<li data-value="private" class="selected">All</li>
								</ul>
							</div>
							<input type="checkbox" id="tsd-filter-inherited" checked />
							<label class="tsd-widget" for="tsd-filter-inherited">Inherited</label>
							<input type="checkbox" id="tsd-filter-externals" checked />
							<label class="tsd-widget" for="tsd-filter-externals">Externals</label>
						</div>
					</div>
					<a href="#" class="tsd-widget menu no-caption" data-toggle="menu">Menu</a>
				</div>
			</div>
		</div>
	</div>
	<div class="tsd-page-title">
		<div class="container">
			<h1>@honestfoodcompany/pubsub</h1>
		</div>
	</div>
</header>
<div class="container container-main">
	<div class="row">
		<div class="col-8 col-content">
			<div class="tsd-panel tsd-typography">
				<a href="#google-pubsub-nodejs-framework" id="google-pubsub-nodejs-framework" style="color: inherit; text-decoration: none;">
					<h1>Google Pub/Sub Node.js Framework</h1>
				</a>
				<p>This package contains a lightweight framework and subscription server for <a href="https://cloud.google.com/pubsub">Google Pub/Sub</a>. It was created to speed up development time and it provides a common foundation for building event driven applications. It lets developers define topics and subscriptions simply and declaratively, while additionally offering a simple subscription server to run all of a project&#39;s subscription handlers.</p>
				<p><img src="demo.gif" alt=""></p>
				<a href="#table-of-contents" id="table-of-contents" style="color: inherit; text-decoration: none;">
					<h2>Table of Contents</h2>
				</a>
				<ul>
					<li><p><a href="#google-pubsub-nodejs-framework">Google Pub/Sub Node.js Framework</a></p>
						<ul>
							<li><a href="#table-of-contents">Table of Contents</a></li>
							<li><a href="#features">Features</a></li>
							<li><a href="#getting-started">Getting started</a></li>
							<li><a href="#required-environment-variables">Required Environment Variables</a></li>
							<li><a href="#cli-commands---starting-and-listing-subscriptions">CLI commands - starting and listing subscriptions</a></li>
							<li><a href="#topics">Topics</a><ul>
									<li><a href="#publishing-a-message-simple-example">Publishing a message (simple example)</a><ul>
											<li><a href="#typescript-example">Typescript example</a></li>
											<li><a href="#javascript-example">Javascript example</a></li>
										</ul>
									</li>
									<li><a href="#publishing-a-message-with-retry-settings">Publishing a message with retry settings</a></li>
									<li><a href="#publishing-on-a-different-gcp-project">Publishing on a different GCP project</a></li>
								</ul>
							</li>
							<li><a href="#subscriptions">Subscriptions</a><ul>
									<li><a href="#typescript-subscription-example">Typescript subscription example</a></li>
									<li><a href="#javascript-subscription-example">Javascript subscription example</a></li>
									<li><a href="#subscription-example-with-subscriber-options">Subscription example with subscriber options</a></li>
									<li><a href="#subscription-with-a-dead-letter-policy">Subscription with a Dead-letter Policy</a><ul>
											<li><a href="#binding-subscriber-and-publisher-role">Binding Subscriber and Publisher role to Dead Letter</a></li>
										</ul>
									</li>
									<li><a href="#subscription-with-retry-policy">Subscription with Retry Policy</a></li>
									<li><a href="#subscription-with-message-ordering">Subscription with Message Ordering</a></li>
								</ul>
							</li>
							<li><a href="#subscriber-options">Subscriber Options</a></li>
							<li><a href="#subscription-service">Subscription Service</a><ul>
									<li><a href="#typescript-example-1">Typescript example</a></li>
									<li><a href="#javascript-example-1">Javascript Example</a></li>
								</ul>
							</li>
							<li><a href="#connecting-to-a-database">Connecting to a database</a></li>
							<li><a href="#enabling-synchronous-driver">Enabling Synchronous Driver</a></li>
							<li><a href="#enabling-grpc-c-bindings">Enabling gRPC C++ bindings</a></li>
						</ul>
					</li>
				</ul>
				<a href="#features" id="features" style="color: inherit; text-decoration: none;">
					<h2>Features</h2>
				</a>
				<ol>
					<li>Run all of your subscriptions at once with a subscription server</li>
					<li>Define pub/sub subscriptions and topics in a declarative way</li>
					<li>Define your subscription handlers with a simple object</li>
					<li>Get started quickly: define a topic and publish messages with a few lines of code</li>
				</ol>
				<a href="#getting-started" id="getting-started" style="color: inherit; text-decoration: none;">
					<h2>Getting started</h2>
				</a>
				<p>The framework expects that you&#39;ve created a pubsub directory in your project with the following structure:</p>
				<pre>
| .env        <-- this should be in your project root directory
| - pubsub/    <-- this can be anywhere (defined in .env as PUBSUB_ROOT_DIR)
|   | - subscriptions/
|   | - topics/
</pre>
				<ol>
					<li>Once the directory structure has been defined, <a href="#required-environment-variables">environment variables should be set</a>.</li>
					<li>Then you can create <a href="#subscriptions">subscriptions</a> and <a href="#topics">topics</a></li>
					<li>After a subscription has been created, use the <a href="#cli-commands---starting-and-listing-subscriptions">CLI</a> to start the subscriptions server.</li>
					<li>Initialize your database connection, define project-level subscription defaults, and register subscriptions in the <a href="#subscription-service">Subscription Service</a>.</li>
				</ol>
				<a href="#required-environment-variables" id="required-environment-variables" style="color: inherit; text-decoration: none;">
					<h2>Required Environment Variables</h2>
				</a>
				<p>The framework expects the following environment variables. They can be added the <code>.env</code> file.</p>
				<pre><code class="language-ini"><span style="color: #0000FF">GOOGLE_APPLICATION_CREDENTIALS</span><span style="color: #000000">=/path/to/gcp-project-83d5537a8388-key.json</span>
<span style="color: #0000FF">GOOGLE_CLOUD_PUB_SUB_PROJECT_ID</span><span style="color: #000000">=gcp-project-id</span>
<span style="color: #0000FF">PUBSUB_ROOT_DIR</span><span style="color: #000000">=/path/to/your/pubsub/directory </span><span style="color: #008000"># this can be a relative path</span>
</code></pre>
				<table>
					<thead>
						<tr>
							<th>Variable</th>
							<th>Description</th>
						</tr>
					</thead>
					<tbody><tr>
							<td><code>PUBSUB_ROOT_DIR</code></td>
							<td>must be the path to your project&#39;s pubsub directory. This module only works with .js files, so if you are writing your code in typescript, you must set this variable to the pubsub directory in your project&#39;s build directory.</td>
						</tr>
						<tr>
							<td><code>GOOGLE_APPLICATION_CREDENTIALS</code></td>
							<td>see <a href="https://cloud.google.com/docs/authentication/getting-started#creating_a_service_account">https://cloud.google.com/docs/authentication/getting-started#creating_a_service_account</a> to generate this</td>
						</tr>
						<tr>
							<td><code>GOOGLE_CLOUD_PUB_SUB_PROJECT_ID</code></td>
							<td>name of the project in Google Cloud Platform</td>
						</tr>
				</tbody></table>
				<a href="#cli-commands---starting-and-listing-subscriptions" id="cli-commands---starting-and-listing-subscriptions" style="color: inherit; text-decoration: none;">
					<h2>CLI commands - starting and listing subscriptions</h2>
				</a>
				<p>Prerequisites: Install npx if you don&#39;t have it installed yet: <code>npm i -g npx</code></p>
				<table>
					<thead>
						<tr>
							<th>Command</th>
							<th>Description</th>
						</tr>
					</thead>
					<tbody><tr>
							<td><code>npx subscriptions start</code></td>
							<td>starts project subscriptions</td>
						</tr>
						<tr>
							<td><code>npx subscriptions list</code></td>
							<td>lists project subscriptions</td>
						</tr>
				</tbody></table>
				<blockquote>
					<p>Alternatively the CLI can be found at <code>./node_modules/.bin/subscriptions</code></p>
				</blockquote>
				<a href="#usage-with-typescript" id="usage-with-typescript" style="color: inherit; text-decoration: none;">
					<h3>Usage with Typescript</h3>
				</a>
				<p>For use with Typescript, update your local <code>PUBSUB_ROOT_DIR</code> env var to the src directory of the project with the typescript files.</p>
				<p>And instead of using <code>npx subscriptions start</code> you can invoke the bin script with <a href="https://github.com/TypeStrong/ts-node/">ts-node</a>:</p>
				<pre><code class="language-sh"><span style="color: #000000">npx ts-node ./node_modules/.bin/subscriptions start</span>
</code></pre>
				<p>If you have a separate <code>tsconfig</code> for your server code then you should pass it to <code>ts-node</code>:</p>
				<pre><code class="language-sh"><span style="color: #000000">npx ts-node --project tsconfig.server.json ./node_modules/.bin/subscriptions start</span>
</code></pre>
				<p>To make this easier you can add a script in your <code>package.json</code>:</p>
				<pre><code class="language-json"><span style="color: #000000">{</span>
<span style="color: #000000">  </span><span style="color: #0451A5">&quot;scripts&quot;</span><span style="color: #000000">: {</span>
<span style="color: #000000">    </span><span style="color: #0451A5">&quot;pubsub&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;ts-node ./node_modules/.bin/subscriptions start&quot;</span>
<span style="color: #000000">  }</span>
<span style="color: #000000">}</span>
</code></pre>
				<a href="#use-debugger-with-typescript" id="use-debugger-with-typescript" style="color: inherit; text-decoration: none;">
					<h4>Use Debugger with Typescript</h4>
				</a>
				<p><code>ts-node</code> doesn&#39;t have an <code>--inspect</code> option unlike the <code>node</code> cli. But we can still pass it to the node process by way of the <code>NODE_OPTIONS</code> env var.</p>
				<pre><code class="language-sh"><span style="color: #000000">NODE_OPTIONS=</span><span style="color: #A31515">&#039;--inspect&#039;</span><span style="color: #000000"> ts-node --project tsconfig.server.json  ./node_modules/.bin/subscriptions start</span>
</code></pre>
				<a href="#watch-mode-with-typescript" id="watch-mode-with-typescript" style="color: inherit; text-decoration: none;">
					<h4>Watch Mode with Typescript</h4>
				</a>
				<p>You can use <code>nodemon</code> in combination with <code>ts-node</code> to develop in watch mode:</p>
				<pre><code class="language-json"><span style="color: #000000">{</span>
<span style="color: #000000">  </span><span style="color: #0451A5">&quot;scripts&quot;</span><span style="color: #000000">: {</span>
<span style="color: #000000">    </span><span style="color: #0451A5">&quot;pubsub&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;nodemon --exec </span><span style="color: #EE0000">\&quot;</span><span style="color: #A31515">NODE_OPTIONS=&#039;--inspect&#039; ts-node --project tsconfig.server.json ./node_modules/.bin/subscriptions start</span><span style="color: #EE0000">\&quot;</span><span style="color: #A31515">&quot;</span>
<span style="color: #000000">  }</span>
<span style="color: #000000">}</span>
</code></pre>
				<a href="#topics" id="topics" style="color: inherit; text-decoration: none;">
					<h2>Topics</h2>
				</a>
				<p>Create a topic in <code>PUBSUB_ROOT_DIR/topics</code> which extends <code>Topic</code> and a payload which extends <code>BasePayload</code></p>
				<pre><code class="language-typescript"><span style="color: #008000">// PUBSUB_ROOT_DIR/topics/simple.topic.name.ts</span>
<span style="color: #AF00DB">import</span><span style="color: #000000"> { </span><span style="color: #001080">Topic</span><span style="color: #000000">, </span><span style="color: #001080">Payload</span><span style="color: #000000"> </span><span style="color: #AF00DB">as</span><span style="color: #000000"> </span><span style="color: #001080">BasePayload</span><span style="color: #000000"> } </span><span style="color: #AF00DB">from</span><span style="color: #000000"> </span><span style="color: #A31515">&#039;@honestfoodcompany/pubsub&#039;</span><span style="color: #000000">;</span>

<span style="color: #AF00DB">export</span><span style="color: #000000"> </span><span style="color: #AF00DB">default</span><span style="color: #000000"> </span><span style="color: #0000FF">class</span><span style="color: #000000"> </span><span style="color: #267F99">SimpleTopic</span><span style="color: #000000"> </span><span style="color: #0000FF">extends</span><span style="color: #000000"> </span><span style="color: #267F99">Topic</span><span style="color: #000000"> {</span>
<span style="color: #000000">  </span><span style="color: #0000FF">readonly</span><span style="color: #000000"> </span><span style="color: #001080">name</span><span style="color: #000000"> = </span><span style="color: #A31515">&#039;simple.topic.name&#039;</span><span style="color: #000000">;</span>
<span style="color: #000000">}</span>

<span style="color: #AF00DB">export</span><span style="color: #000000"> </span><span style="color: #0000FF">interface</span><span style="color: #000000"> </span><span style="color: #267F99">Payload</span><span style="color: #000000"> </span><span style="color: #0000FF">extends</span><span style="color: #000000"> </span><span style="color: #267F99">BasePayload</span><span style="color: #000000"> {</span>
<span style="color: #000000">  </span><span style="color: #001080">id</span><span style="color: #000000">: </span><span style="color: #267F99">number</span><span style="color: #000000">;</span>
<span style="color: #000000">  </span><span style="color: #001080">data</span><span style="color: #000000">: </span><span style="color: #267F99">string</span><span style="color: #000000">;</span>
<span style="color: #000000">}</span>
</code></pre>
				<blockquote>
					<p>As a convention, the name of the topic file should match the name of the topic name so the file directory becomes self-documenting.</p>
				</blockquote>
				<a href="#publishing-a-message-simple-example" id="publishing-a-message-simple-example" style="color: inherit; text-decoration: none;">
					<h3>Publishing a message (simple example)</h3>
				</a>
				<p>If a topic does not exist, it will be created before a message is published.</p>
				<a href="#typescript-example" id="typescript-example" style="color: inherit; text-decoration: none;">
					<h4>Typescript example</h4>
				</a>
				<pre><code class="language-typescript"><span style="color: #008000">// client.example.ts</span>
<span style="color: #AF00DB">import</span><span style="color: #000000"> </span><span style="color: #001080">SimpleTopic</span><span style="color: #000000">, { </span><span style="color: #001080">Payload</span><span style="color: #000000"> } </span><span style="color: #AF00DB">from</span><span style="color: #000000"> </span><span style="color: #A31515">&#039;PUBSUB_ROOT_DIR/topics/simple.topic.name&#039;</span><span style="color: #000000">;</span>

<span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #795E26">SimpleTopic</span><span style="color: #000000">().</span><span style="color: #795E26">publish</span><span style="color: #000000">&lt;</span><span style="color: #267F99">Payload</span><span style="color: #000000">&gt;({ </span><span style="color: #001080">id:</span><span style="color: #000000"> </span><span style="color: #098658">1</span><span style="color: #000000">, </span><span style="color: #001080">data:</span><span style="color: #000000"> </span><span style="color: #A31515">&#039;My first message&#039;</span><span style="color: #000000"> });</span>
</code></pre>
				<a href="#javascript-example" id="javascript-example" style="color: inherit; text-decoration: none;">
					<h4>Javascript example</h4>
				</a>
				<pre><code class="language-typescript"><span style="color: #008000">// client.example.ts</span>
<span style="color: #AF00DB">import</span><span style="color: #000000"> </span><span style="color: #001080">SimpleTopic</span><span style="color: #000000"> </span><span style="color: #AF00DB">from</span><span style="color: #000000"> </span><span style="color: #A31515">&#039;PUBSUB_ROOT_DIR/topics/simple.topic.name&#039;</span><span style="color: #000000">;</span>

<span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #795E26">SimpleTopic</span><span style="color: #000000">().</span><span style="color: #795E26">publish</span><span style="color: #000000">({ </span><span style="color: #001080">id:</span><span style="color: #000000"> </span><span style="color: #098658">1</span><span style="color: #000000">, </span><span style="color: #001080">data:</span><span style="color: #000000"> </span><span style="color: #A31515">&#039;My first message&#039;</span><span style="color: #000000"> });</span>
</code></pre>
				<a href="#publishing-a-message-with-retry-settings" id="publishing-a-message-with-retry-settings" style="color: inherit; text-decoration: none;">
					<h3>Publishing a message with retry settings</h3>
				</a>
				<p>see <a href="https://github.com/honest-food-company/pubsub/tree/master/examples/typescript/test.topic.withRetrySettings.ts">Sample Topic with Retry Settings</a> for defining a default retry policy</p>
				<pre><code class="language-typescript"><span style="color: #008000">// client.example.ts</span>
<span style="color: #AF00DB">import</span><span style="color: #000000"> </span><span style="color: #001080">SimpleTopic</span><span style="color: #000000">, { </span><span style="color: #001080">Payload</span><span style="color: #000000"> } </span><span style="color: #AF00DB">from</span><span style="color: #000000"> </span><span style="color: #A31515">&#039;pubsub/topics/simple.topic.name&#039;</span><span style="color: #000000">;</span>

<span style="color: #0000FF">let</span><span style="color: #000000"> </span><span style="color: #001080">topic</span><span style="color: #000000"> = </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #795E26">SimpleTopic</span><span style="color: #000000">();</span>
<span style="color: #001080">topic</span><span style="color: #000000">.</span><span style="color: #795E26">publish</span><span style="color: #000000">&lt;</span><span style="color: #267F99">Payload</span><span style="color: #000000">&gt;(</span>
<span style="color: #000000">  { </span><span style="color: #001080">id:</span><span style="color: #000000"> </span><span style="color: #098658">1</span><span style="color: #000000">, </span><span style="color: #001080">data:</span><span style="color: #000000"> </span><span style="color: #A31515">&#039;My first message&#039;</span><span style="color: #000000"> },</span>
<span style="color: #000000">  {</span>
<span style="color: #000000">    </span><span style="color: #001080">retryCodes:</span><span style="color: #000000"> [</span><span style="color: #098658">10</span><span style="color: #000000">, </span><span style="color: #098658">1</span><span style="color: #000000">],</span>
<span style="color: #000000">    </span><span style="color: #001080">backoffSettings:</span><span style="color: #000000"> {</span>
<span style="color: #000000">      </span><span style="color: #001080">initialRetryDelayMillis:</span><span style="color: #000000"> </span><span style="color: #098658">100</span><span style="color: #000000">,</span>
<span style="color: #000000">    },</span>
<span style="color: #000000">  },</span>
<span style="color: #000000">);</span>
</code></pre>
				<a href="#publishing-on-a-different-gcp-project" id="publishing-on-a-different-gcp-project" style="color: inherit; text-decoration: none;">
					<h3>Publishing on a different GCP project</h3>
				</a>
				<p>see <a href="https://github.com/honest-food-company/pubsub/tree/master/__tests__/pubsub/topics/example.topic_withProjectCredentials.ts">Sample Topic using its own GCP Project</a></p>
				<a href="#subscriptions" id="subscriptions" style="color: inherit; text-decoration: none;">
					<h2>Subscriptions</h2>
				</a>
				<p>Create a <code>Subscriber</code> to define a message handler for messages that are published on the corresponding topic.</p>
				<p>Subscribers are contained in <code>PUBSUB_ROOT_DIR/subscriptions</code>.</p>
				<blockquote>
					<p>Files ending in <code>.sub.js</code> in <code>PUBSUB_ROOT_DIR/subscriptions</code> will be autoloaded by the subscription server.</p>
				</blockquote>
				<a href="#typescript-subscription-example" id="typescript-subscription-example" style="color: inherit; text-decoration: none;">
					<h3>Typescript subscription example</h3>
				</a>
				<pre><code class="language-typescript"><span style="color: #008000">// PUBSUB_ROOT_DIR/subscriptions/simple.topic.name.console-log.sub.ts</span>
<span style="color: #AF00DB">import</span><span style="color: #000000"> { </span><span style="color: #001080">SubscriberObject</span><span style="color: #000000">, </span><span style="color: #001080">Message</span><span style="color: #000000"> } </span><span style="color: #AF00DB">from</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;@honestfoodcompany/pubsub&quot;</span><span style="color: #000000">; </span><span style="color: #008000">// this import is optional, it&#039;s gives us the interfaces to use below</span>

<span style="color: #0000FF">export</span><span style="color: #000000"> </span><span style="color: #AF00DB">default</span><span style="color: #000000">: </span><span style="color: #001080">SubscriberObject</span><span style="color: #000000"> = {</span>
<span style="color: #000000">  </span><span style="color: #001080">topicName:</span><span style="color: #000000"> </span><span style="color: #A31515">&#039;simple.topic&#039;</span><span style="color: #000000">,</span>
<span style="color: #000000">  </span><span style="color: #001080">subscriptionName:</span><span style="color: #000000"> </span><span style="color: #A31515">&#039;simple.topic.console-log.sub&#039;</span><span style="color: #000000">,</span>
<span style="color: #000000">  </span><span style="color: #001080">description:</span><span style="color: #000000"> </span><span style="color: #A31515">&#039;Will console log messages published on test.topic&#039;</span><span style="color: #000000">,</span>

<span style="color: #000000">  </span><span style="color: #795E26">handleMessage</span><span style="color: #001080">:</span><span style="color: #000000"> </span><span style="color: #0000FF">function</span><span style="color: #000000">(</span><span style="color: #001080">message</span><span style="color: #000000">: </span><span style="color: #267F99">Message</span><span style="color: #000000">): </span><span style="color: #267F99">void</span><span style="color: #000000"> {</span>
<span style="color: #000000">    </span><span style="color: #001080">console</span><span style="color: #000000">.</span><span style="color: #795E26">log</span><span style="color: #000000">(</span><span style="color: #0000FF">this</span><span style="color: #000000">.</span><span style="color: #001080">subscriptionName</span><span style="color: #000000">, </span><span style="color: #A31515">&#039;received message&#039;</span><span style="color: #000000">);</span>
<span style="color: #000000">    </span><span style="color: #001080">console</span><span style="color: #000000">.</span><span style="color: #795E26">log</span><span style="color: #000000">(</span><span style="color: #001080">message</span><span style="color: #000000">.</span><span style="color: #001080">data</span><span style="color: #000000">.</span><span style="color: #795E26">toString</span><span style="color: #000000">());</span>
<span style="color: #000000">    </span><span style="color: #001080">message</span><span style="color: #000000">.</span><span style="color: #795E26">ack</span><span style="color: #000000">();</span>
<span style="color: #000000">  },</span>
<span style="color: #000000">};</span>

</code></pre>
				<a href="#javascript-subscription-example" id="javascript-subscription-example" style="color: inherit; text-decoration: none;">
					<h3>Javascript subscription example</h3>
				</a>
				<pre><code class="language-javascript"><span style="color: #008000">// PUBSUB_ROOT_DIR/subscriptions/simple.topic.name.sub.js</span>
<span style="color: #267F99">exports</span><span style="color: #000000">.</span><span style="color: #001080">default</span><span style="color: #000000"> = {</span>
<span style="color: #000000">  </span><span style="color: #001080">topicName:</span><span style="color: #000000"> </span><span style="color: #A31515">&#039;test.topic&#039;</span><span style="color: #000000">,</span>
<span style="color: #000000">  </span><span style="color: #001080">subscriptionName:</span><span style="color: #000000"> </span><span style="color: #A31515">&#039;test.topic.sub&#039;</span><span style="color: #000000">,</span>
<span style="color: #000000">  </span><span style="color: #001080">description:</span><span style="color: #000000"> </span><span style="color: #A31515">&#039;Will console log messages published on test.topic&#039;</span><span style="color: #000000">,</span>

<span style="color: #000000">  </span><span style="color: #795E26">handleMessage</span><span style="color: #001080">:</span><span style="color: #000000"> </span><span style="color: #0000FF">function</span><span style="color: #000000"> (</span><span style="color: #001080">message</span><span style="color: #000000">) {</span>
<span style="color: #000000">    </span><span style="color: #001080">console</span><span style="color: #000000">.</span><span style="color: #795E26">log</span><span style="color: #000000">(</span><span style="color: #0000FF">this</span><span style="color: #000000">.</span><span style="color: #001080">subscriptionName</span><span style="color: #000000">, </span><span style="color: #A31515">&#039;received message&#039;</span><span style="color: #000000">);</span>
<span style="color: #000000">    </span><span style="color: #001080">console</span><span style="color: #000000">.</span><span style="color: #795E26">log</span><span style="color: #000000">(</span><span style="color: #001080">message</span><span style="color: #000000">.</span><span style="color: #001080">data</span><span style="color: #000000">.</span><span style="color: #795E26">toString</span><span style="color: #000000">());</span>
<span style="color: #000000">    </span><span style="color: #001080">message</span><span style="color: #000000">.</span><span style="color: #795E26">ack</span><span style="color: #000000">();</span>
<span style="color: #000000">  },</span>
<span style="color: #000000">};</span>
</code></pre>
				<a href="#subscription-example-with-subscriber-options" id="subscription-example-with-subscriber-options" style="color: inherit; text-decoration: none;">
					<h3>Subscription example with <a href="#subscriber-options">subscriber options</a></h3>
				</a>
				<pre><code class="language-javascript"><span style="color: #008000">// PUBSUB_ROOT_DIR/subscriptions/simple.topic.name.subscription.js</span>
<span style="color: #267F99">exports</span><span style="color: #000000">.</span><span style="color: #001080">default</span><span style="color: #000000"> = {</span>
<span style="color: #000000">  </span><span style="color: #001080">topicName:</span><span style="color: #000000"> </span><span style="color: #A31515">&#039;test.topic&#039;</span><span style="color: #000000">,</span>
<span style="color: #000000">  </span><span style="color: #001080">subscriptionName:</span><span style="color: #000000"> </span><span style="color: #A31515">&#039;test.topic.subscription&#039;</span><span style="color: #000000">,</span>
<span style="color: #000000">  </span><span style="color: #001080">description:</span><span style="color: #000000"> </span><span style="color: #A31515">&#039;Will console log messages published on test.topic&#039;</span><span style="color: #000000">,</span>
<span style="color: #000000">  </span><span style="color: #001080">options:</span><span style="color: #000000"> {</span>
<span style="color: #000000">    </span><span style="color: #001080">flowControl:</span><span style="color: #000000"> {</span>
<span style="color: #000000">      </span><span style="color: #001080">maxMessages:</span><span style="color: #000000"> </span><span style="color: #098658">500</span><span style="color: #000000">, </span><span style="color: #008000">// max messages in progress</span>
<span style="color: #000000">    },</span>
<span style="color: #000000">  },</span>
<span style="color: #000000">  </span><span style="color: #795E26">handleMessage</span><span style="color: #001080">:</span><span style="color: #000000"> </span><span style="color: #0000FF">function</span><span style="color: #000000"> (</span><span style="color: #001080">message</span><span style="color: #000000">) {</span>
<span style="color: #000000">    </span><span style="color: #001080">console</span><span style="color: #000000">.</span><span style="color: #795E26">log</span><span style="color: #000000">(</span><span style="color: #A31515">`received a message on </span><span style="color: #0000FF">${</span><span style="color: #0000FF">this</span><span style="color: #000000FF">.</span><span style="color: #001080">subscriptionName</span><span style="color: #0000FF">}</span><span style="color: #A31515">`</span><span style="color: #000000">);</span>
<span style="color: #000000">    </span><span style="color: #001080">console</span><span style="color: #000000">.</span><span style="color: #795E26">log</span><span style="color: #000000">(</span><span style="color: #001080">message</span><span style="color: #000000">.</span><span style="color: #001080">data</span><span style="color: #000000">.</span><span style="color: #795E26">toString</span><span style="color: #000000">());</span>
<span style="color: #000000">    </span><span style="color: #001080">message</span><span style="color: #000000">.</span><span style="color: #795E26">ack</span><span style="color: #000000">();</span>
<span style="color: #000000">  },</span>
<span style="color: #000000">};</span>
</code></pre>
				<a href="#subscription-with-a-dead-letter-policy" id="subscription-with-a-dead-letter-policy" style="color: inherit; text-decoration: none;">
					<h3>Subscription with a Dead-letter Policy</h3>
				</a>
				<p>It is possible to define a dead-letter policy for a subscription. If the dead letter topic does not exist, it will be created automatically by the framework. There needs to be a <code>PROJECT_NUMBER</code> defined for dead letter to pick up publisher, subscriber role. Check <a href="#binding-subscriber-and-publisher-role">Binding Subscriber and Publisher role</a> for more details</p>
				<pre><code class="language-javascript"><span style="color: #008000">// PUBSUB_ROOT_DIR/subscriptions/simple.topic.sub.js</span>
<span style="color: #267F99">exports</span><span style="color: #000000">.</span><span style="color: #001080">default</span><span style="color: #000000"> = {</span>
<span style="color: #000000">  </span><span style="color: #001080">topicName:</span><span style="color: #000000"> </span><span style="color: #A31515">&#039;test.topic&#039;</span><span style="color: #000000">,</span>
<span style="color: #000000">  </span><span style="color: #001080">subscriptionName:</span><span style="color: #000000"> </span><span style="color: #A31515">&#039;test.topic.sub&#039;</span><span style="color: #000000">,</span>
<span style="color: #000000">  </span><span style="color: #001080">description:</span><span style="color: #000000"> </span><span style="color: #A31515">&#039;Will console log messages published on test.topic&#039;</span><span style="color: #000000">,</span>
<span style="color: #000000">  </span><span style="color: #001080">options:</span><span style="color: #000000"> {</span>
<span style="color: #000000">    </span><span style="color: #001080">deadLetterPolicy:</span><span style="color: #000000"> {</span>
<span style="color: #000000">      </span><span style="color: #001080">deadLetterTopic:</span><span style="color: #000000"> </span><span style="color: #A31515">&#039;test.deadletter.topic&#039;</span><span style="color: #000000">,</span>
<span style="color: #000000">      </span><span style="color: #001080">maxDeliveryAttempts:</span><span style="color: #000000"> </span><span style="color: #098658">15</span><span style="color: #000000">,</span>
<span style="color: #000000">    },</span>
<span style="color: #000000">  },</span>
<span style="color: #000000">  </span><span style="color: #795E26">handleMessage</span><span style="color: #001080">:</span><span style="color: #000000"> </span><span style="color: #0000FF">function</span><span style="color: #000000"> (</span><span style="color: #001080">message</span><span style="color: #000000">) {</span>
<span style="color: #000000">    </span><span style="color: #001080">console</span><span style="color: #000000">.</span><span style="color: #795E26">log</span><span style="color: #000000">(</span><span style="color: #A31515">`received a message on </span><span style="color: #0000FF">${</span><span style="color: #0000FF">this</span><span style="color: #000000FF">.</span><span style="color: #001080">subscriptionName</span><span style="color: #0000FF">}</span><span style="color: #A31515">`</span><span style="color: #000000">);</span>
<span style="color: #000000">    </span><span style="color: #001080">console</span><span style="color: #000000">.</span><span style="color: #795E26">log</span><span style="color: #000000">(</span><span style="color: #001080">message</span><span style="color: #000000">.</span><span style="color: #001080">data</span><span style="color: #000000">.</span><span style="color: #795E26">toString</span><span style="color: #000000">());</span>
<span style="color: #000000">  },</span>
<span style="color: #000000">};</span>
</code></pre>
				<a href="#binding-subscriber-and-publisher-role" id="binding-subscriber-and-publisher-role" style="color: inherit; text-decoration: none;">
					<h3>Binding Subscriber and Publisher role</h3>
				</a>
				<p>To automatically have a Publisher,Subscriber role attached to your dead letters you need to add <code>PROJECT_NUMBER</code> in the env list. If this <code>PROJECT_NUMBER</code> isn&#39;t available in env then it&#39;ll not assign the above roles.
				Binding the above policies don&#39;t require current subscriptions to be deleted. Just specifying <code>PROJECT_NUMBER</code> will bind the roles to dead letter.</p>
				<p>To find out project number through CLI use the commands below:</p>
				<ul>
					<li><code>PROJECT=$(gcloud config get-value project)</code></li>
					<li><code>gcloud projects list --filter=&quot;$PROJECT&quot; --format=&quot;value(PROJECT_NUMBER)&quot;</code></li>
				</ul>
				<a href="#subscription-with-retry-policy" id="subscription-with-retry-policy" style="color: inherit; text-decoration: none;">
					<h3>Subscription with Retry Policy</h3>
				</a>
				<p>It is possible to define a retry configuration for a subscription:</p>
				<pre><code class="language-javascript"><span style="color: #008000">// PUBSUB_ROOT_DIR/subscriptions/simple.topic.name.subscription.sub.js</span>
<span style="color: #267F99">exports</span><span style="color: #000000">.</span><span style="color: #001080">default</span><span style="color: #000000"> = {</span>
<span style="color: #000000">  </span><span style="color: #001080">topicName:</span><span style="color: #000000"> </span><span style="color: #A31515">&#039;test.topic&#039;</span><span style="color: #000000">,</span>
<span style="color: #000000">  </span><span style="color: #001080">subscriptionName:</span><span style="color: #000000"> </span><span style="color: #A31515">&#039;test.topic.sub&#039;</span><span style="color: #000000">,</span>
<span style="color: #000000">  </span><span style="color: #001080">description:</span><span style="color: #000000"> </span><span style="color: #A31515">&#039;Will console log messages published on test.topic&#039;</span><span style="color: #000000">,</span>
<span style="color: #000000">  </span><span style="color: #001080">options:</span><span style="color: #000000"> {</span>
<span style="color: #000000">    </span><span style="color: #001080">retryPolicy:</span><span style="color: #000000"> {</span>
<span style="color: #000000">      </span><span style="color: #001080">minimumBackoff:</span><span style="color: #000000"> { </span><span style="color: #001080">seconds:</span><span style="color: #000000"> </span><span style="color: #098658">20</span><span style="color: #000000">, </span><span style="color: #001080">nanos:</span><span style="color: #000000"> </span><span style="color: #098658">20</span><span style="color: #000000"> },</span>
<span style="color: #000000">      </span><span style="color: #001080">maximumBackoff:</span><span style="color: #000000"> { </span><span style="color: #001080">seconds:</span><span style="color: #000000"> </span><span style="color: #098658">400</span><span style="color: #000000">, </span><span style="color: #001080">nanos:</span><span style="color: #000000"> </span><span style="color: #098658">2</span><span style="color: #000000"> },</span>
<span style="color: #000000">    },</span>
<span style="color: #000000">  },</span>
<span style="color: #000000">  </span><span style="color: #795E26">handleMessage</span><span style="color: #001080">:</span><span style="color: #000000"> </span><span style="color: #0000FF">function</span><span style="color: #000000"> (</span><span style="color: #001080">message</span><span style="color: #000000">) {</span>
<span style="color: #000000">    </span><span style="color: #001080">console</span><span style="color: #000000">.</span><span style="color: #795E26">log</span><span style="color: #000000">(</span><span style="color: #A31515">`received a message on </span><span style="color: #0000FF">${</span><span style="color: #0000FF">this</span><span style="color: #000000FF">.</span><span style="color: #001080">subscriptionName</span><span style="color: #0000FF">}</span><span style="color: #A31515">`</span><span style="color: #000000">);</span>
<span style="color: #000000">    </span><span style="color: #001080">console</span><span style="color: #000000">.</span><span style="color: #795E26">log</span><span style="color: #000000">(</span><span style="color: #001080">message</span><span style="color: #000000">.</span><span style="color: #001080">data</span><span style="color: #000000">.</span><span style="color: #795E26">toString</span><span style="color: #000000">());</span>
<span style="color: #000000">  },</span>
<span style="color: #000000">};</span>
</code></pre>
				<a href="#subscription-with-message-ordering" id="subscription-with-message-ordering" style="color: inherit; text-decoration: none;">
					<h3>Subscription with Message Ordering</h3>
				</a>
				<p>Messages published with the same <code>ordering_key</code> in <code>PubsubMessage</code> will be delivered to the subscribers in the order in which they are received by the Pub/Sub system.</p>
				<pre><code class="language-javascript"><span style="color: #008000">// PUBSUB_ROOT_DIR/subscriptions/simple.topic.name.subscription.sub.js</span>
<span style="color: #267F99">exports</span><span style="color: #000000">.</span><span style="color: #001080">default</span><span style="color: #000000"> = {</span>
<span style="color: #000000">  </span><span style="color: #001080">topicName:</span><span style="color: #000000"> </span><span style="color: #A31515">&#039;test.topic&#039;</span><span style="color: #000000">,</span>
<span style="color: #000000">  </span><span style="color: #001080">subscriptionName:</span><span style="color: #000000"> </span><span style="color: #A31515">&#039;test.topic.sub&#039;</span><span style="color: #000000">,</span>
<span style="color: #000000">  </span><span style="color: #001080">description:</span><span style="color: #000000"> </span><span style="color: #A31515">&#039;Will console log messages published on test.topic&#039;</span><span style="color: #000000">,</span>
<span style="color: #000000">  </span><span style="color: #001080">options:</span><span style="color: #000000"> {</span>
<span style="color: #000000">    </span><span style="color: #001080">enableMessageOrdering:</span><span style="color: #000000"> </span><span style="color: #0000FF">true</span>
<span style="color: #000000">  },</span>
<span style="color: #000000">  </span><span style="color: #795E26">handleMessage</span><span style="color: #001080">:</span><span style="color: #000000"> </span><span style="color: #0000FF">function</span><span style="color: #000000">(</span><span style="color: #001080">message</span><span style="color: #000000">) {</span>
<span style="color: #000000">    </span><span style="color: #001080">console</span><span style="color: #000000">.</span><span style="color: #795E26">log</span><span style="color: #000000">(</span><span style="color: #A31515">`received a message on </span><span style="color: #0000FF">${</span><span style="color: #0000FF">this</span><span style="color: #000000FF">.</span><span style="color: #001080">subscriptionName</span><span style="color: #0000FF">}</span><span style="color: #A31515">`</span><span style="color: #000000">);</span>
<span style="color: #000000">    </span><span style="color: #001080">console</span><span style="color: #000000">.</span><span style="color: #795E26">log</span><span style="color: #000000">(</span><span style="color: #001080">message</span><span style="color: #000000">.</span><span style="color: #001080">data</span><span style="color: #000000">.</span><span style="color: #795E26">toString</span><span style="color: #000000">());</span>
<span style="color: #000000">  },</span>
<span style="color: #000000">};</span>
</code></pre>
				<a href="#subscriber-options" id="subscriber-options" style="color: inherit; text-decoration: none;">
					<h2>Subscriber Options</h2>
				</a>
				<p><a href="#subscription-example-with-subscriber-options">Usage Example</a></p>
				<pre><code class="language-typescript"><span style="color: #0000FF">interface</span><span style="color: #000000"> </span><span style="color: #267F99">SubscriberOptions</span><span style="color: #000000"> {</span>

<span style="color: #000000">  </span><span style="color: #008000">/**</span>
<span style="color: #008000">   * override the default project settings from the environment variable</span>
<span style="color: #008000">   * and use the project defined here instead for the subscription</span>
<span style="color: #008000">   **/</span>
<span style="color: #000000">  </span><span style="color: #001080">project</span><span style="color: #000000">?: {</span>
<span style="color: #000000">    </span><span style="color: #001080">id</span><span style="color: #000000">: </span><span style="color: #267F99">string</span><span style="color: #000000">;</span>
<span style="color: #000000">    </span><span style="color: #001080">credentials</span><span style="color: #000000">: {</span>
<span style="color: #000000">      </span><span style="color: #001080">client_email</span><span style="color: #000000">?: </span><span style="color: #267F99">string</span><span style="color: #000000">;</span>
<span style="color: #000000">      </span><span style="color: #001080">private_key</span><span style="color: #000000">?: </span><span style="color: #267F99">string</span><span style="color: #000000">;</span>
<span style="color: #000000">    }</span>
<span style="color: #000000">  },</span>

<span style="color: #000000">  </span><span style="color: #008000">/**</span>
<span style="color: #008000">   * in seconds</span>
<span style="color: #008000">   **/</span>
<span style="color: #000000">  </span><span style="color: #001080">ackDeadline</span><span style="color: #000000">?: </span><span style="color: #267F99">number</span><span style="color: #000000">;</span>


<span style="color: #000000">  </span><span style="color: #001080">batching</span><span style="color: #000000">?: {</span>
<span style="color: #000000">    </span><span style="color: #001080">callOptions</span><span style="color: #000000">?: </span><span style="color: #267F99">CallOptions</span><span style="color: #000000">; </span><span style="color: #008000">// see https://github.com/googleapis/gax-nodejs/blob/77f16fd2ac2f1bd90cc6abfcccafa94a20582017/src/gax.ts#L114</span>
<span style="color: #000000">    </span><span style="color: #001080">maxMessages</span><span style="color: #000000">?: </span><span style="color: #267F99">number</span><span style="color: #000000">;</span>
<span style="color: #000000">    </span><span style="color: #001080">maxMilliseconds</span><span style="color: #000000">?: </span><span style="color: #267F99">number</span><span style="color: #000000">;</span>
<span style="color: #000000">  };</span>
<span style="color: #000000">  </span><span style="color: #001080">flowControl</span><span style="color: #000000">?: {</span>
<span style="color: #000000">    </span><span style="color: #001080">allowExcessMessages</span><span style="color: #000000">?: </span><span style="color: #267F99">boolean</span><span style="color: #000000">;</span>
<span style="color: #000000">    </span><span style="color: #001080">maxBytes</span><span style="color: #000000">?: </span><span style="color: #267F99">number</span><span style="color: #000000">;</span>
<span style="color: #000000">    </span><span style="color: #001080">maxExtension</span><span style="color: #000000">?: </span><span style="color: #267F99">number</span><span style="color: #000000">;</span>
<span style="color: #000000">    </span><span style="color: #001080">maxMessages</span><span style="color: #000000">?: </span><span style="color: #267F99">number</span><span style="color: #000000">;</span>
<span style="color: #000000">  };</span>
<span style="color: #000000">  </span><span style="color: #001080">streamingOptions</span><span style="color: #000000">?: {</span>
<span style="color: #000000">    </span><span style="color: #001080">highWaterMark</span><span style="color: #000000">?: </span><span style="color: #267F99">number</span><span style="color: #000000">;</span>
<span style="color: #000000">    </span><span style="color: #001080">maxStreams</span><span style="color: #000000">?: </span><span style="color: #267F99">number</span><span style="color: #000000">;</span>
<span style="color: #000000">    </span><span style="color: #001080">timeout</span><span style="color: #000000">?: </span><span style="color: #267F99">number</span><span style="color: #000000">;</span>
<span style="color: #000000">  };</span>
<span style="color: #000000">  </span><span style="color: #001080">deadLetterPolicy</span><span style="color: #000000">?: {</span>
<span style="color: #000000">    </span><span style="color: #001080">deadLetterTopic</span><span style="color: #000000">: </span><span style="color: #267F99">string</span><span style="color: #000000">;</span>
<span style="color: #000000">    </span><span style="color: #001080">maxDeliveryAttempts</span><span style="color: #000000">: </span><span style="color: #267F99">number</span><span style="color: #000000">;</span>
<span style="color: #000000">  };</span>
<span style="color: #000000">  </span><span style="color: #001080">retryPolicy</span><span style="color: #000000">?: {</span>
<span style="color: #000000">    </span><span style="color: #001080">minimumBackoff</span><span style="color: #000000">: { </span><span style="color: #001080">seconds</span><span style="color: #000000">: </span><span style="color: #267F99">number</span><span style="color: #000000">; </span><span style="color: #001080">nanos</span><span style="color: #000000">?: </span><span style="color: #267F99">number</span><span style="color: #000000"> }; </span><span style="color: #008000">// &quot;10s&quot;-&quot;599s&quot;</span>
<span style="color: #000000">    </span><span style="color: #001080">maximumBackoff</span><span style="color: #000000">: { </span><span style="color: #001080">seconds</span><span style="color: #000000">: </span><span style="color: #267F99">number</span><span style="color: #000000">; </span><span style="color: #001080">nanos</span><span style="color: #000000">?: </span><span style="color: #267F99">number</span><span style="color: #000000"> }; </span><span style="color: #008000">// &quot;11s&quot;-&quot;600s&quot;</span>
<span style="color: #000000">  };</span>

<span style="color: #000000">  </span><span style="color: #008000">/**</span>
<span style="color: #008000">   *   An expression written in the Pub/Sub [filter</span>
<span style="color: #008000">   *   language](https://cloud.google.com/pubsub/docs/filtering). If non-empty,</span>
<span style="color: #008000">   *   then only `PubsubMessage`s whose `attributes` field matches the filter are</span>
<span style="color: #008000">   *   delivered on this subscription. If empty, then no messages are filtered</span>
<span style="color: #008000">   *   out.</span>
<span style="color: #008000">   * */</span>
<span style="color: #000000">  </span><span style="color: #001080">filter</span><span style="color: #000000">?: </span><span style="color: #267F99">string</span><span style="color: #000000">;</span>

<span style="color: #000000">  </span><span style="color: #008000">/**</span>
<span style="color: #008000">   *   If true, messages published with the same `ordering_key` in `PubsubMessage`</span>
<span style="color: #008000">   *   will be delivered to the subscribers in the order in which they</span>
<span style="color: #008000">   *   are received by the Pub/Sub system. Otherwise, they may be delivered in</span>
<span style="color: #008000">   *   any order.</span>
<span style="color: #008000">   */</span>
<span style="color: #000000">  </span><span style="color: #001080">enableMessageOrdering</span><span style="color: #000000">?: </span><span style="color: #267F99">boolean</span><span style="color: #000000">;</span>
<span style="color: #000000">}</span>
</code></pre>
				<a href="#subscription-service" id="subscription-service" style="color: inherit; text-decoration: none;">
					<h2>Subscription Service</h2>
				</a>
				<p>Extend and customize the behavior of the subscription server in the subscription service file. Initialize a database connection, register subscribers, and define default subscriber options in the subscription service file.</p>
				<a href="#typescript-example-1" id="typescript-example-1" style="color: inherit; text-decoration: none;">
					<h3>Typescript example</h3>
				</a>
				<pre><code class="language-javascript"><span style="color: #008000">// PUBSUB_ROOT_DIR/subscription.service.js</span>
<span style="color: #AF00DB">import</span><span style="color: #000000"> </span><span style="color: #0000FF">*</span><span style="color: #000000"> </span><span style="color: #AF00DB">as</span><span style="color: #000000"> </span><span style="color: #001080">PubSub</span><span style="color: #000000"> </span><span style="color: #AF00DB">from</span><span style="color: #000000"> </span><span style="color: #A31515">&#039;@honestfoodcompany/pubsub&#039;</span><span style="color: #000000">;</span>
<span style="color: #AF00DB">import</span><span style="color: #000000"> { </span><span style="color: #001080">SubscriberOptions</span><span style="color: #000000"> } </span><span style="color: #AF00DB">from</span><span style="color: #000000"> </span><span style="color: #A31515">&#039;@honestfoodcompany/pubsub&#039;</span><span style="color: #000000">;</span>

<span style="color: #AF00DB">export</span><span style="color: #000000"> </span><span style="color: #AF00DB">default</span><span style="color: #000000"> </span><span style="color: #0000FF">class</span><span style="color: #000000"> </span><span style="color: #267F99">SubscriptionService</span><span style="color: #000000"> </span><span style="color: #0000FF">extends</span><span style="color: #000000"> </span><span style="color: #267F99">PubSub</span><span style="color: #000000">.</span><span style="color: #267F99">SubscriptionService</span><span style="color: #000000"> {</span>
<span style="color: #000000">  </span><span style="color: #0000FF">static</span><span style="color: #000000"> </span><span style="color: #001080">subscribers</span><span style="color: #000000"> = [</span>
<span style="color: #000000">    </span><span style="color: #008000">/**</span>
<span style="color: #008000">     * if your subscribers don&#039;t have the .sub.js suffix</span>
<span style="color: #008000">     * they won&#039;t be auto-loaded,  so you can include their default</span>
<span style="color: #008000">     * export in  this array</span>
<span style="color: #008000">     */</span>
<span style="color: #000000">  ];</span>

<span style="color: #000000">  </span><span style="color: #0000FF">static</span><span style="color: #000000"> </span><span style="color: #001080">defaultSubscriberOptions</span><span style="color: #000000">: </span><span style="color: #267F99">SubscriberOptions</span><span style="color: #000000"> = {</span>
<span style="color: #000000">    </span><span style="color: #008000">/**</span>
<span style="color: #008000">     * Define project level default subscriber options here.</span>
<span style="color: #008000">     * These options can be overridden by options defined in subscribers</span>
<span style="color: #008000">     */</span>
<span style="color: #000000">  };</span>

<span style="color: #000000">  </span><span style="color: #0000FF">static</span><span style="color: #000000"> </span><span style="color: #0000FF">async</span><span style="color: #000000"> </span><span style="color: #795E26">init</span><span style="color: #000000">(): </span><span style="color: #267F99">Promise</span><span style="color: #000000">&lt;</span><span style="color: #267F99">void</span><span style="color: #000000">&gt; {</span>
<span style="color: #000000">    </span><span style="color: #008000">/**</span>
<span style="color: #008000">     * This function is called when the subscription server starts.</span>
<span style="color: #008000">     * This is a good place to initialize a database connection</span>
<span style="color: #008000">     */</span>
<span style="color: #000000">  }</span>
<span style="color: #000000">}</span>
</code></pre>
				<a href="#javascript-example-1" id="javascript-example-1" style="color: inherit; text-decoration: none;">
					<h3>Javascript Example</h3>
				</a>
				<pre><code class="language-javascript"><span style="color: #008000">// PUBSUB_ROOT_DIR/subscription.service.js</span>
<span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">PubSub</span><span style="color: #000000"> = </span><span style="color: #795E26">require</span><span style="color: #000000">(</span><span style="color: #A31515">&#039;@honestfoodcompany/pubsub&#039;</span><span style="color: #000000">);</span>

<span style="color: #0000FF">class</span><span style="color: #000000"> </span><span style="color: #267F99">SubscriptionService</span><span style="color: #000000"> </span><span style="color: #0000FF">extends</span><span style="color: #000000"> </span><span style="color: #267F99">PubSub</span><span style="color: #000000">.</span><span style="color: #267F99">SubscriptionService</span><span style="color: #000000"> {}</span>

<span style="color: #001080">SubscriptionService</span><span style="color: #000000">.</span><span style="color: #001080">subscribers</span><span style="color: #000000"> = [</span>
<span style="color: #000000">  </span><span style="color: #008000">/**</span>
<span style="color: #008000">   * if your subscribers don&#039;t have the .sub.js suffix</span>
<span style="color: #008000">   * they won&#039;t be auto-loaded,  so you can include their default</span>
<span style="color: #008000">   * export in  this array</span>
<span style="color: #008000">   */</span>
<span style="color: #000000">];</span>

<span style="color: #001080">SubscriptionService</span><span style="color: #000000">.</span><span style="color: #001080">defaultSubscriberOptions</span><span style="color: #000000"> = {</span>
<span style="color: #000000">  </span><span style="color: #008000">/**</span>
<span style="color: #008000">   * Define project-level default subscriber options here.</span>
<span style="color: #008000">   * These options can be overridden by options defined in subscribers</span>
<span style="color: #008000">   */</span>
<span style="color: #000000">};</span>

<span style="color: #001080">SubscriptionService</span><span style="color: #000000">.</span><span style="color: #795E26">init</span><span style="color: #000000"> = () </span><span style="color: #0000FF">=&gt;</span><span style="color: #000000"> {</span>
<span style="color: #000000">  </span><span style="color: #008000">/**</span>
<span style="color: #008000">   * This function is called when the subscription server starts.</span>
<span style="color: #008000">   * This is a good place to initialize a database connection</span>
<span style="color: #008000">   */</span>
<span style="color: #000000">};</span>

<span style="color: #267F99">exports</span><span style="color: #000000">.</span><span style="color: #001080">default</span><span style="color: #000000"> = </span><span style="color: #001080">SubscriptionService</span><span style="color: #000000">;</span>
</code></pre>
				<a href="#connecting-to-a-database" id="connecting-to-a-database" style="color: inherit; text-decoration: none;">
					<h2>Connecting to a database</h2>
				</a>
				<p>It is recommended to initialize a database connection in the <code>subscription.service</code> file in your <code>PUBSUB_ROOT_DIR</code>. Insert your database connection logic in the <code>init</code> method.</p>
				<p>see: <a href="#subscription-service">Subscription Service</a> for more details</p>
				<a href="#enabling-synchronous-driver" id="enabling-synchronous-driver" style="color: inherit; text-decoration: none;">
					<h2>Enabling Synchronous Driver</h2>
				</a>
				<p>If you would like to bypass Google PubSub and run your subscriptions synchronously (for development purposes) set the following environment variable:</p>
				<p><code>PUBSUB_DRIVER=synchronous</code></p>
				<a href="#enabling-grpc-c-bindings" id="enabling-grpc-c-bindings" style="color: inherit; text-decoration: none;">
					<h2>Enabling gRPC C++ bindings</h2>
				</a>
				<p>For some workflows and environments it might make sense to use the C++ gRPC implementation, instead of the default one. To configure the module to use an alternative grpc transport use the following environment variable:</p>
				<pre><code class="language-shell"><span style="color: #000000">PUBSUB_USE_GRPC=true</span>
</code></pre>
			</div>
		</div>
		<div class="col-4 col-menu menu-sticky-wrap menu-highlight">
			<nav class="tsd-navigation primary">
				<ul>
					<li class=" ">
						<a href="modules.html">Exports</a>
					</li>
					<li class=" tsd-kind-namespace">
						<a href="modules/interfaces.html">Interfaces</a>
					</li>
				</ul>
			</nav>
			<nav class="tsd-navigation secondary menu-sticky">
				<ul class="before-current">
					<li class=" tsd-kind-class">
						<a href="classes/message.html" class="tsd-kind-icon">Message</a>
					</li>
					<li class=" tsd-kind-class">
						<a href="classes/pubsubservice.html" class="tsd-kind-icon">Pub<wbr>Sub<wbr>Service</a>
					</li>
					<li class=" tsd-kind-class">
						<a href="classes/subscriber.html" class="tsd-kind-icon">Subscriber</a>
					</li>
					<li class=" tsd-kind-class">
						<a href="classes/subscriptionservice.html" class="tsd-kind-icon">Subscription<wbr>Service</a>
					</li>
					<li class=" tsd-kind-class">
						<a href="classes/topic.html" class="tsd-kind-icon">Topic</a>
					</li>
					<li class=" tsd-kind-interface">
						<a href="interfaces/payload.html" class="tsd-kind-icon">Payload</a>
					</li>
					<li class=" tsd-kind-interface">
						<a href="interfaces/subscriberoptions.html" class="tsd-kind-icon">Subscriber<wbr>Options</a>
					</li>
					<li class=" tsd-kind-type-alias">
						<a href="modules.html#subscriberobject" class="tsd-kind-icon">Subscriber<wbr>Object</a>
					</li>
					<li class=" tsd-kind-variable">
						<a href="modules.html#subscriberv2" class="tsd-kind-icon">Subscriber<wbr>V2</a>
					</li>
				</ul>
			</nav>
		</div>
	</div>
</div>
<footer class="with-border-bottom">
	<div class="container">
		<h2>Legend</h2>
		<div class="tsd-legend-group">
			<ul class="tsd-legend">
				<li class="tsd-kind-constructor tsd-parent-kind-class"><span class="tsd-kind-icon">Constructor</span></li>
				<li class="tsd-kind-property tsd-parent-kind-class"><span class="tsd-kind-icon">Property</span></li>
				<li class="tsd-kind-method tsd-parent-kind-class"><span class="tsd-kind-icon">Method</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-property tsd-parent-kind-class tsd-is-protected"><span class="tsd-kind-icon">Protected property</span></li>
				<li class="tsd-kind-method tsd-parent-kind-class tsd-is-protected"><span class="tsd-kind-icon">Protected method</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-property tsd-parent-kind-class tsd-is-static"><span class="tsd-kind-icon">Static property</span></li>
				<li class="tsd-kind-method tsd-parent-kind-class tsd-is-static"><span class="tsd-kind-icon">Static method</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-property tsd-parent-kind-interface"><span class="tsd-kind-icon">Property</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-method tsd-parent-kind-class tsd-is-private"><span class="tsd-kind-icon">Private method</span></li>
			</ul>
		</div>
	</div>
</footer>
<div class="container tsd-generator">
	<p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p>
</div>
<div class="overlay"></div>
<script src="assets/js/main.js"></script>
</body>
</html>